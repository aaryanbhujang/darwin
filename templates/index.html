<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WiFi Network Analyzer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/mZEZxP6wX/gcdQJ9w="
        crossorigin=""/>
  <style>
    :root {
      --primary: #8a2be2;
      --secondary: #00d1b2;
      --dark: #0a0a0a;
      --darker: #000000;
      --accent: #ff3860;
      --light: #f8f9fa;
      --success: #00d1b2;
      --warning: #ffdd57;
      --danger: #ff3860;
      --card-bg: rgba(20, 20, 30, 0.9);
      --text-primary: #ffffff;
      --text-secondary: #a0aec0;
      --border-color: rgba(255, 255, 255, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, var(--darker) 0%, #1a1a2e 100%);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* HEADER */
    header {
      padding: 1.5rem 2rem;
      text-align: center;
      background: rgba(10, 10, 10, 0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 1px;
      position: relative;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary);
      text-shadow: 0 0 10px rgba(138, 43, 226, 0.3);
    }
    
    header::before {
      content: '📡';
      font-size: 2rem;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* BUTTONS */
    .controls {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin: 2rem auto;
      flex-wrap: wrap;
      padding: 0 1rem;
    }
    
    .btn {
      border: none;
      padding: 0.8rem 2rem;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .btn i {
      font-size: 1.1rem;
    }
    
    .btn-scan {
      background: var(--primary);
      color: white;
    }
    
    .btn-show {
      background: var(--success);
      color: white;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }
    
    .btn:active {
      transform: translateY(0);
    }

    /* DASHBOARD */
    .dashboard {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }
    
    .card h2 {
      margin: 0 0 20px 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* TABLE */
    .table-wrapper { 
      grid-column: span 2; 
      overflow-x: auto;
      width: 100%;
    }
    
    .table-container {
      width: 100%;
      overflow-x: auto;
      margin-top: 1rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: rgba(20, 20, 30, 0.5);
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      min-width: 800px;
    }
    
    table th, table td {
      padding: 1rem 1.25rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-primary);
      vertical-align: middle;
    }
    
    table th {
      background: rgba(138, 43, 226, 0.2);
      color: var(--primary);
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
      border-bottom: 2px solid var(--primary);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    
    table tr:last-child td { 
      border-bottom: none; 
    }
    
    table tr:hover { 
      background: rgba(74, 144, 226, 0.1); 
    }

    /* CHART */
    .chart-container {
      position: relative;
      height: 250px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
    }
    
    .chart-container canvas {
      max-width: 100% !important;
      max-height: 100% !important;
      aspect-ratio: 1;
    }

    /* MAP */
    .map-container {
      position: relative;
      height: 400px;
      width: 100%;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 10px;
      border: 1px solid var(--border-color);
      background: var(--darker);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .static-map { 
      width: 100%; 
      height: 100%; 
      overflow: hidden; 
    }
    
    .map-image { 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
      opacity: 0.9; 
    }
    
    .network-indicators {
      position: absolute; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      pointer-events: none;
    }
    
    .network-marker {
      position: absolute;
      width: 12px; 
      height: 12px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid white;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      pointer-events: auto;
    }
    
    .network-marker:hover {
      transform: translate(-50%, -50%) scale(1.5);
      box-shadow: 0 0 10px rgba(255,255,255,0.8);
    }
    
    .map-legend {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    
    .legend-dot {
      display: inline-block;
      width: 12px; 
      height: 12px;
      border-radius: 50%;
      margin-right: 5px;
    }

    /* SIGNAL BAR */
    .signal-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
      width: 100px;
      margin: 0 auto;
    }
    
    .signal-level {
      height: 100%;
      background: linear-gradient(90deg, #ff3860, #8a2be2);
      border-radius: 4px;
      transition: width 0.5s ease;
      position: relative;
    }
    
    .signal-level::after {
      content: '';
      position: absolute; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0;
      background: linear-gradient(90deg, 
        rgba(255,255,255,0.15) 0%, 
        rgba(255,255,255,0.1) 50%, 
        rgba(255,255,255,0.15) 100%
      );
      pointer-events: none;
    }

    /* TABLE ROWS + DETAILS */
    .network-row { 
      cursor: pointer; 
      transition: background-color 0.2s ease; 
    }
    
    .network-row:hover { 
      background-color: rgba(138, 43, 226, 0.1); 
    }
    
    .network-row.expanded { 
      background-color: rgba(138, 43, 226, 0.15); 
    }
    
    .network-details { 
      background-color: rgba(0, 0, 0, 0.2); 
      display: none; 
    }
    
    .network-details-content {
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .detail-row { 
      display: flex; 
      align-items: flex-start;
      margin-bottom: 8px; 
      flex-wrap: wrap;
    }
    
    .detail-label {
      font-weight: 500;
      color: var(--text-secondary);
      margin-right: 8px;
      min-width: 100px;
      font-size: 0.9em;
    }
    
    .detail-value { 
      font-family: 'Roboto Mono', monospace; 
      color: var(--text-primary);
      word-break: break-word;
      flex: 1;
      min-width: 0;
    }

    /* ENCRYPTION TAGS */
    .encryption-tag {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.75em;
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    
    .encryption-tag.wpa2 { 
      background-color: rgba(0, 209, 178, 0.15); 
      color: #00d1b2; 
    }
    
    .encryption-tag.wpa3 { 
      background-color: rgba(72, 199, 142, 0.15); 
      color: #48c78e; 
    }
    
    .encryption-tag.wep { 
      background-color: rgba(255, 221, 87, 0.15); 
      color: #ffdd57; 
    }
    
    .encryption-tag.open { 
      background-color: rgba(255, 56, 96, 0.15); 
      color: #ff3860; 
    }

  </style>
</head>
<body>
  <header>WiFi Network Analyzer</header>

  <div class="controls">
    <form action="/scan_wifi" method="post" class="form-scan">
      <button type="submit" class="btn btn-scan">
        <i>🔍</i> Scan Networks
      </button>
    </form>
    <form action="/show_wifi" method="post" class="form-show">
      <button type="submit" class="btn btn-show">
        <i>📶</i> Show Networks
      </button>
    </form>
  </div>

  <div class="dashboard">
    <!-- Encryption Pie Chart -->
    <div class="card">
      <h2><i>🔒</i> Encryption Distribution</h2>
      <div class="chart-container">
        <canvas id="encryptionChart"></canvas>
      </div>
    </div>

    <!-- Map Container -->
    <div class="card">
      <h2><i>📍</i> Network Map</h2>
      <div class="map-container">
        <div class="static-map">
          <img src="static/pccoe.png" alt="PCCOE Campus Map" class="map-image" 
               onerror="this.onerror=null; this.src='https://via.placeholder.com/800x600/2d3748/4a5568?text=PCCOE+Map';">
          <div class="network-indicators" id="networkIndicators"></div>
        </div>
      </div>
      <div class="map-legend">
        <div><span class="legend-dot" style="background: #ff6b6b;"></span> WPA</div>
        <div><span class="legend-dot" style="background: #ffd93d;"></span> WEP</div>
        <div><span class="legend-dot" style="background: #6cff6c;"></span> Open</div>
      </div>
    </div>

    <!-- Network Statistics -->
    <div class="card">
      <h2><i>📊</i> Network Statistics</h2>
      <div class="big-number">{{ total_networks }}<span style="font-size: 1.2rem; color: #aaa; margin-left: 0.5rem;">Networks</span></div>
      <div style="display: flex; justify-content: space-between; margin-top: 1.5rem;">
        <div style="text-align: center;">
          <div style="font-size: 0.9rem; color: #aaa; margin-bottom: 0.3rem;">WPA</div>
          <div style="font-size: 1.2rem; font-weight: 500;">{{ (networks|selectattr('encryption', 'equalto', 'WPA')|list|length) }}</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 0.9rem; color: #aaa; margin-bottom: 0.3rem;">WEP</div>
          <div style="font-size: 1.2rem; font-weight: 500;">{{ (networks|selectattr('encryption', 'equalto', 'WEP')|list|length) }}</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 0.9rem; color: #aaa; margin-bottom: 0.3rem;">Open</div>
          <div style="font-size: 1.2rem; font-weight: 500;">{{ (networks|selectattr('encryption', 'equalto', 'Open')|list|length) }}</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2><i>📈</i> Signal Strength Distribution</h2>
      <canvas id="signalChart"></canvas>
    </div>

    <div class="table-wrapper card">
      <h2>Available Networks ({{ networks|length }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>SSID</th>
              <th>Encryption</th>
              <th>Channel</th>
              <th>Signal</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for network in networks %}
            <tr class="network-row" data-signal="{{ network.power }}" data-bssid="{{ network.bssid or '' }}">
              <td class="network-ssid">
                <i class="network-icon">📶</i>
                <span>{{ network.ssid or 'Hidden Network' }}</span>
              </td>
              <td>
                <span class="encryption-tag {{ network.encryption|lower }}">
                  {{ network.encryption or 'Unknown' }}
                </span>
              </td>
              <td>{{ network.channel or 'N/A' }}</td>
              <td>
                <div class="signal-bar" title="{{ network.power or 'N/A' }}">
                  <div class="signal-level" data-quality="{{ (network.power|default('-100')|replace(' dBm','')|int|abs) }}"></div>
                </div>
              </td>
              <td>
                <button class="btn btn-show" data-ssid="{{ network.ssid or '' }}">
                  <i class="fas fa-wifi"></i> Connect
                </button>
              </td>
            </tr>
            <tr class="network-details" id="details-{{ network.bssid|default('unknown', true)|replace(':', '-') }}">
              <td colspan="5">
                <div class="detail-row">
                  <span class="detail-label">Vulnerability:</span>
                  <span class="detail-value vulnerability-{{ 'high' if network.encryption in ['WEP', 'Open'] else 'low' }}">
                    {{ 'High' if network.encryption in ['WEP', 'Open'] else 'Low' }}
                    ({{ '90%' if network.encryption in ['WEP', 'Open'] else '10%' }})
                  </span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Encryption Strength:</span>
                  <span class="detail-value">
                    {% if network.encryption == 'WPA3' %}
                      Strong (AES-256)
                    {% elif network.encryption == 'WPA2' %}
                      Good (AES-128)
                    {% elif network.encryption == 'WPA' %}
                      Weak (TKIP)
                    {% else %}
                      Very Weak ({{ network.encryption }})
                    {% endif %}
                  </span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Security Recommendation:</span>
                  <span class="detail-value">
                    {% if network.encryption in ['WPA2', 'WPA3'] %}
                      Secure enough for most uses
                    {% elif network.encryption == 'WPA' %}
                      Consider upgrading to WPA2/WPA3
                    {% else %}
                      Avoid using this network for sensitive data
                    {% endif %}
                  </span>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

     <script>
    // WiFi Network Analyzer Application
    document.addEventListener('DOMContentLoaded', function() {
      'use strict';

      // Main application object
      const app = {
        // Cache DOM elements
        elements: {
          networkRows: null,
          networkDetails: null
        },

        // Initialize the application
        init: function() {
          try {
            this.cacheElements();
            this.setupEventListeners();
            this.animateTableRows();
            this.updateNetworkStats();
          } catch (error) {
            console.error('Error initializing application:', error);
          }
        },

        // Cache frequently used DOM elements
        cacheElements: function() {
          this.elements.networkRows = document.querySelectorAll('.network-row');
          this.elements.networkDetails = document.querySelectorAll('.network-details');
        },

        // Set up event listeners
        setupEventListeners: function() {
          // Delegate click events for better performance
          document.addEventListener('click', (e) => {
            const row = e.target.closest('.network-row');
            if (!row) {
              this.hideAllDetails();
              return;
            }
            this.toggleNetworkDetails(row);
          });
        },

        // Hide all network details
        hideAllDetails: function() {
          try {
            document.querySelectorAll('.network-details').forEach(d => {
              d.style.display = 'none';
            });
            document.querySelectorAll('.network-row').forEach(r => {
              r.classList.remove('active');
            });
          } catch (error) {
            console.error('Error hiding details:', error);
          }
        },

        // Toggle network details for a specific row
        toggleNetworkDetails: function(row) {
          try {
            const bssid = row.getAttribute('data-bssid');
            if (!bssid) return;

            const detailsId = `details-${bssid.replace(/:/g, '-')}`;
            const details = document.getElementById(detailsId);
            if (!details) return;

            const isActive = row.classList.contains('active');
            this.hideAllDetails();

            if (!isActive) {
              details.style.display = 'table-row';
              row.classList.add('active');
              details.scrollIntoView({
                behavior: 'smooth',
                block: 'nearest'
              });
            }
          } catch (error) {
            console.error('Error toggling network details:', error);
          }
        },

        // Animate table rows on load
        animateTableRows: function() {
          try {
            const rows = document.querySelectorAll('table tbody tr:not(.network-details)');
            if (!rows.length) return;

            rows.forEach((row, index) => {
              // Reset styles for re-animation
              row.style.opacity = '0';
              row.style.transform = 'translateX(-20px)';
              row.style.transition = `opacity 0.3s ease ${index * 0.05}s, transform 0.3s ease ${index * 0.05}s`;
            });

            // Trigger animation on next frame
            requestAnimationFrame(() => {
              rows.forEach(row => {
                row.style.opacity = '1';
                row.style.transform = 'translateX(0)';
              });
            });
          } catch (error) {
            console.error('Error animating table rows:', error);
          }
        },

        // Update network signal statistics
        updateNetworkStats: function() {
          try {
            document.querySelectorAll('.signal-level').forEach(level => {
              if (!level || !level.parentElement) return;
              
              const signalStr = level.parentElement.getAttribute('data-signal') || '-50';
              const signal = parseInt(signalStr.replace(/[^0-9-]/g, ''), 10) || -50;
              const quality = Math.min(100, Math.max(0, 2 * (signal + 100)));
              
              if (level.style) {
                level.style.width = `${quality}%`;
              }
              
              level.setAttribute('title', `${signal} dBm (${Math.round(quality)}% signal strength)`);
            });
          } catch (error) {
            console.error('Error updating network stats:', error);
          }
        }
      };

      // Initialize the application
      app.init();
    });

  </script>
</body>
</html>
